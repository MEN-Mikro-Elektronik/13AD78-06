<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - AD78/PUx MDIS Driver - Main Page</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;">
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">AD78/PUx MDIS Driver &nbsp; </h1>
	<h3>Main Page</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindexHL" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>AD78/PUx MDIS Driver Documentation</h1>
<p>
This is the documentation of the MDIS5 low-level driver for the monitoring controller on the AD78 PSU and the PU5.<p>
<dl compact><dt><b>Attention:</b></dt><dd><b>Renaming of AD78 to PU2</b><br>
<br>
 Article numbers and names of MEN power supplies were restructured.<br>
 The power supply formerly known as 08AD78 is now called PU2 on the MEN website, to show its relation to the new PUx group of powersupplies from MEN. To remain compatible with previous hard- and software the name AD78 is kept throughout this document. It currently describes the features of the AD78 and PU5 power supply, more PUx variants will follow in future.</dd></dl>
The AD78 and PU5 PSU are power supplies with control and supervision functionality:<ul>
<li>programmable Power Up Wake ON Time</li><li>Power Up/Down handshake</li><li>Watchdog functionality</li><li>GPIO support</li><li>temperature and voltage supervision</li></ul>
<p>
Note: MDIS5 32bit drivers are compatible to the MDIS4 drivers but must not be mixed with MDIS4 drivers at one target system.<p>
<br>
 <dl compact><dt><b>Attention:</b></dt><dd><b>Current measurement change on PUx Rev.01</b><br>
 All power supplies PUx with Rev. R01 and up measure only the overall current drawn on the 12V rail and no more the single currents drawn by the 5V and 3.3V rail. Therefore reading out 3.3V and 5V current returns 0. The overall drawn power can still be calculated with P[mW]=12V x I12V[mA].<br>
</dd></dl>
<b>Common Notes:</b><ul>
<li>The driver requires MDIS with SMB2 support <br>
 </li></ul>
<h2><a name="Variants"></a>
Variants</h2>
In order to support different AD78 modes, the AD78 driver can be built in some variants at compilation time:<p>
<div class="fragment"><pre>    Driver              Variant Description
    --------            --------------------------------
    Standard            standard variant
</pre></div><p>
<br>
 <h2><a name="FuncDesc"></a>
Functional Description</h2>
<br>
 <h3><a name="General"></a>
General</h3>
The driver supports controlling of the AD78 PSU via <a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a13">M_setstat()</a> and <a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat()</a>. No interrupts are used. The driver can inform applications via an MDIS signal about a shutdown event by polling the AD78 PSU, see <a class="el" href="ad78__drv_8h.html#a20">AD78_BLK_DOWN_SIG_SET</a>.<p>
When the first path is opened to an AD78 device, the HW and the driver are being initialized with default values (see section about <a class="el" href="index.html#descriptor_entries">AD78 Descriptor Entries</a>). <br>
 The AD78 and PU5 power supplies use the same driver and share the identical basic set of GetStat- and SetStat codes. The PU5 also provides 3 output rails ( 3.3V, 5V, 12V ) instead the two rails on the AD78. For each of these rails limits can be set for over/undervoltage and over/undercurrent. <br>
<p>
<br>
 <h3><a name="channel"></a>
MDIS channels on PU5</h3>
To reduce the amount of different GetStat and SetStat codes the MDIS concept of channels is used for PU5. That means that before a certain limit for voltage or current can be set the channel has to be selected in the application. The channels are defined for PU5 as below: <br>
 <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td><b>channel 0:</b></td><td>select 3.3V rail </td></tr>
<tr>
<td><b>channel 1:</b></td><td>select 5V rail </td></tr>
<tr>
<td><b>channel 2:</b></td><td>select 12V rail </td></tr>
</table>
<br>
<p>
As an example the simplified code snippet below shows how the channels are used to read out voltage and current from the 3.3V rail and 5V rail: <div class="fragment"><pre>    <span class="comment">/* Attention: simplified, no error checks! */</span>
    int32 voltage, current;
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a13">M_setstat</a>(G_Path, M_MK_CH_CURRENT,  0); <span class="comment">/* next Getstats go to 3.3V rail */</span>
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat</a>(G_Path, PU05_VOLT, &amp;voltage);
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat</a>(G_Path, PU05_CURR, &amp;current);
    printf(<span class="stringliteral">"Now on 3,3V rail: %d volt %d mA\n"</span>, voltage, current);
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a13">M_setstat</a>(G_Path, M_MK_CH_CURRENT,  1); <span class="comment">/* next Getstats go to 5V rail */</span>
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat</a>(G_Path, PU05_VOLT, &amp;voltage);
    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat</a>(G_Path, PU05_CURR, &amp;current);
    printf(<span class="stringliteral">"Now on 5V rail: %d volt %d mA\n"</span>, voltage, current);
</pre></div><p>
<br>
 <h2><a name="api_functions"></a>
Supported API Functions</h2>
<table border="0" cellspacing="3" cellpadding="3">
<tr>
<td><b>API Function</b> </td><td><b>Functionality</b> </td><td><b>Corresponding Low-Level Function</b><p>
</td></tr>
<tr>
<td><a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a4">M_open()</a></td><td>Open device</td><td><a class="el" href="ad78__drv_8c.html#a18">AD78_Init()</a><p>
</td></tr>
<tr>
<td><a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a9">M_close()</a> </td><td>Close device  </td><td><a class="el" href="ad78__drv_8c.html#a19">AD78_Exit()</a>) </td></tr>
<tr>
<td><a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a13">M_setstat()</a> </td><td>Set device parameter  </td><td><a class="el" href="ad78__drv_8c.html#a22">AD78_SetStat()</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/mdis__api_8c.html#a12">M_getstat()</a> </td><td>Get device parameter  </td><td><a class="el" href="ad78__drv_8c.html#a23">AD78_GetStat()</a> </td></tr>
<tr>
<td><a class="elRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/m__errstr_8c.html#a1">M_errstringTs()</a> </td><td>Generate error message  </td><td>- </td></tr>
</table>
<p>
<br>
 <h2><a name="descriptor_entries"></a>
AD78 Descriptor Entries</h2>
The low-level driver initialization routine decodes the following entries ("keys") in addition to the general descriptor keys:<p>
<table border="0" cellspacing="3" cellpadding="3">
<tr>
<td><b>Descriptor entry</b> </td><td><b>Description</b> </td><td><b>Values</b>  </td></tr>
<tr>
<td>SMB_BUSNBR </td><td>SMBus bus number </td><td>0, 1, 2, ...<br>
 Default: 0  </td></tr>
<tr>
<td>SMB_DEVADDR </td><td>SMBus address of AD78 </td><td>0x00, 0xff<br>
 Default: 0x12  </td></tr>
<tr>
<td>ONACK_TOUT </td><td>ON acknowledge timeout mode </td><td>see <a class="el" href="group____AD78C__ONACK__TOUT.html">ON Acknowledge Timeout defines</a><br>
 Default: 0 (no timeout)  </td></tr>
<tr>
<td>WDOG_TOUT </td><td>Watchdog timeout in 100ms units </td><td>1..255 [100ms]<br>
 Default: 255  </td></tr>
<tr>
<td>DOWN_DELAY </td><td>Shutdown delay mode </td><td>see <a class="el" href="group____AD78C__DOWN__DELAY.html">Shutdown Delay defines</a><br>
 Default: 0 (no delay)  </td></tr>
<tr>
<td>OFF_DELAY </td><td>Off delay mode </td><td>see <a class="el" href="group____AD78C__OFF__DELAY.html">OFF Delay defines</a><br>
 Default: 0 (no delay)  </td></tr>
<tr>
<td>TEMP_HIGH </td><td>Temperature high limit in degree celsius </td><td>50..90°C<br>
 Default: 90°C  </td></tr>
</table>
<p>
<br>
 <h3><a name="ad78_min"></a>
Minimum descriptor</h3>
ad78_min.dsc (see Examples section)<br>
 Demonstrates the minimum set of options necessary for using the driver.<p>
<br>
 <h3><a name="ad78_max"></a>
Maximum descriptor</h3>
ad78_max.dsc (see Examples section)<br>
 Shows all possible configuration options for this driver.<p>
<br>
 <h2><a name="codes"></a>
AD78 specific Getstat/Setstat codes</h2>
For the watchdog functionality, the driver supports the WDOG Getstat/Setstat codes (defined in <a class="el" href="wdog_8h.html">wdog.h</a>):<ul>
<li><a class="el" href="wdog_8h.html#a1">WDOG_START</a></li><li><a class="el" href="wdog_8h.html#a3">WDOG_STOP</a></li><li><a class="el" href="wdog_8h.html#a2">WDOG_TRIG</a></li><li><a class="el" href="wdog_8h.html#a4">WDOG_TIME</a></li><li><a class="el" href="wdog_8h.html#a5">WDOG_STATUS</a></li><li><a class="el" href="wdog_8h.html#a6">WDOG_SHOT</a><br>
</li></ul>
<p>
The other driver functionality is supported by the AD78 Getstat/Setstat codes. See <a class="el" href="ad78__drv_8h.html#ad78_getset_codes">section about AD78 Getstat/Setstat codes</a>.<p>
<br>
 <h2><a name="pu05codes"></a>
PU5 specific Getstat/Setstat codes</h2>
For the additional PU5 functionality like setting the voltage and current limits, see <a class="el" href="ad78__drv_8h.html#pu05_getset_codes">section about PU5 Getstat/Setstat codes</a>. Getstat/Setstat codes (defined in <a class="el" href="ad78__drv_8h.html">ad78_drv.h</a>):<p>
<br>
 <h2><a name="programs"></a>
Overview of provided programs</h2>
<h3><a name="ad78_simp"></a>
Simple example for using the driver</h3>
<a class="el" href="ad78__simp_8c.html">ad78_simp.c</a> (see example section)<h3><a name="ad78_ctrl"></a>
Tool to control AD78 PIC</h3>
<a class="el" href="ad78__ctrl_8c.html">ad78_ctrl.c</a> (see example section)<h3><a name="pu05_ctrl"></a>
Tool to control the additional PU5 functions</h3>
<a class="el" href="pu05__ctrl_8c.html">pu05_ctrl.c</a> (see example section)<h3><a name="wdog_test"></a>
Tool to service and test the watchdog</h3>
<a class="el" href="wdog__test_8c.html">wdog_test.c</a> (see example section) 
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for AD78/PUx MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2019 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

